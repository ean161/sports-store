<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" lang="en">
<th:block th:replace="~{layout/profile :: layout(~{::content}, 'Order Details')}">
    <th:block th:fragment="content">
        <main>
            <div class="w-full mx-auto">
                <div>
                    <h2 class="text-3xl font-bold">Order Details</h2>
                    <p class="pb-3 space-y-4 mt-4 text-base" th:text="'Order #' + ${pack.sign}"></p>
                </div>

                <div class="bg-white border border-gray-200 rounded-lg overflow-hidden mb-6">
                    <div class="grid grid-cols-1 md:grid-cols-6 gap-0 border-b border-gray-200">
                        <div class="px-6 py-4 border-r border-gray-200">
                            <label class="block text-xs font-semibold text-gray-500 uppercase mb-2">Order Status</label>
                            <div>
                                <span th:if="${pack.status == 'SUCCESS'}"
                                      class="px-3 py-2 inline-flex text-xs bg-green-100 text-green-700">Success</span>
                                <span th:if="${pack.status == 'PENDING_APPROVAL'}"
                                      class="px-3 py-2 inline-flex text-xs bg-yellow-100 text-yellow-700">Pending approval</span>
                                <span th:if="${pack.status == 'IN_TRANSIT'}"
                                      class="px-3 py-2 inline-flex text-xs bg-yellow-100 text-yellow-700">In transit</span>
                                <span th:if="${pack.status == 'PENDING_PAYMENT'}"
                                      class="px-3 py-2 inline-flex text-xs bg-yellow-100 text-yellow-700">Pending payment</span>
                                <span th:if="${pack.status == 'PENDING_ORDER'}"
                                      class="px-3 py-2 inline-flex text-xs bg-yellow-100 text-yellow-700">Pending order</span>
                                <span th:if="${pack.status == 'CANCELLED'}"
                                      class="px-3 py-2 inline-flex text-xs bg-red-100 text-red-700">Cancelled</span>
                                <span th:if="${pack.status == 'REFUNDING'}"
                                      class="px-3 py-2 inline-flex text-xs bg-orange-100 text-orange-700">Refunding</span>
                            </div>
                        </div>

                        <div class="px-6 py-4 border-r border-gray-200">
                            <label class="block text-xs font-semibold text-gray-500 uppercase mb-2">Total goods</label>
                            <p class="text-lg font-bold text-blue-600" th:text="${pack.getTotalProductCost()} + '₫'"></p>
                        </div>

                        <div class="px-6 py-4 border-r border-gray-200">
                            <label class="block text-xs font-semibold text-gray-500 uppercase mb-2">Discount</label>
                            <p class="text-lg font-bold text-blue-600" th:text="'-' + ${pack.getDiscount()} + '₫'"></p>
                        </div>

                        <div class="px-6 py-4 border-r border-gray-200">
                            <label class="block text-xs font-semibold text-gray-500 uppercase mb-2">Shipping fee</label>
                            <p class="text-lg font-bold text-blue-600" th:text="${pack.shippingFee} + '₫'"></p>
                        </div>

                        <div class="px-6 py-4 border-r border-gray-200">
                            <label class="block text-xs font-semibold text-gray-500 uppercase mb-2">Total Amount</label>
                            <p class="text-lg font-bold text-red-600" th:text="${pack.totalPrice} + '₫'"></p>
                        </div>

                        <div class="px-6 py-4">
                            <label class="block text-xs font-semibold text-gray-500 uppercase mb-2">Order Date</label>
                            <p class="text-sm font-medium text-gray-700" th:text="${pack.createdAt}"></p>
                        </div>
                    </div>
                </div>

                <div class="bg-white border border-gray-200 rounded-lg overflow-hidden mb-6">
                    <div class="px-6 py-4 border-b border-gray-200 bg-gray-50">
                        <h3 class="text-base font-semibold text-gray-900">Order Information</h3>
                    </div>
                    <div class="px-6 py-4">
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                            <div>
                                <label class="block text-xs font-semibold text-gray-500 uppercase mb-2">Order ID</label>
                                <p class="text-sm font-medium text-gray-900" th:text="${pack.id}"></p>
                            </div>
                            <div>
                                <label class="block text-xs font-semibold text-gray-500 uppercase mb-2">Order
                                    Code</label>
                                <p class="text-sm font-medium text-gray-900" th:text="${pack.sign}"></p>
                            </div>
                            <div>
                                <label class="block text-xs font-semibold text-gray-500 uppercase mb-2">Payment
                                    Type</label>
                                <p class="text-sm font-medium text-gray-900"
                                   th:text="${pack.paymentType != null ? pack.paymentType : 'N/A'}"></p>
                            </div>
                            <div>
                                <label class="block text-xs font-semibold text-gray-500 uppercase mb-2">Payment
                                    Status</label>
                                <p class="text-sm font-medium text-gray-900"
                                   th:text="${pack.paymentStatus != null ? pack.paymentStatus : 'N/A'}"></p>
                            </div>
                        </div>
                    </div>
                </div>

                <div th:if="${pack.address != null}" class="bg-white border border-gray-200 rounded-lg overflow-hidden mb-6">
                    <div class="px-6 py-4 border-b border-gray-200 bg-gray-50">
                        <h3 class="text-base font-semibold text-gray-900">Contact Information</h3>
                    </div>
                    <div class="px-6 py-4">
                        <div class="space-y-2">
                            <p class="text-sm font-medium text-gray-900"
                               th:text="${pack.address.note  + ' | ' + pack.address.phoneNumber}"></p>
                            <p class="text-sm text-gray-700"
                               th:text="${pack.address.addressDetail + ', ' + pack.address.province.name + ', ' + pack.address.ward.name}"></p>
                        </div>
                    </div>
                </div>

                <div class="bg-white border border-gray-200 rounded-lg overflow-hidden">
                    <div class="px-6 py-4 border-b border-gray-200 bg-gray-50">
                        <h3 class="text-base font-semibold text-gray-900">Order Items</h3>
                    </div>
                    <div class="overflow-x-auto">
                        <table class="w-full border-collapse">
                            <thead class="border-b border-gray-200">
                            <tr class="bg-gray-50">
                                <th class="px-6 py-3 text-left text-xs font-semibold text-gray-700 uppercase">
                                    Product
                                </th>
                                <th class="px-6 py-3 text-center text-xs font-semibold text-gray-700 uppercase">
                                    Quantity
                                </th>
                                <th class="px-6 py-3 text-center text-xs font-semibold text-gray-700 uppercase">
                                    Unit price
                                </th>
                                <th class="px-6 py-3 text-right text-xs font-semibold text-gray-700 uppercase">
                                    Total
                                </th>
                            </tr>
                            </thead>
                            <tbody class="divide-y divide-gray-200">
                            <tr th:each="productSnapshot, iterStat : ${productSnapshots}"
                                class="hover:bg-blue-50 transition-colors duration-200">
                                <td class="px-6 py-4">
                                    <div class="flex items-start gap-3">
                                        <a th:href="${liveProds.get(productSnapshot) == null ? '#' : '/product/' + productSnapshot.productId}"
                                           class="flex-shrink-0">
                                            <img th:src="${liveProds.get(productSnapshot) == null ? '/assets/img/wrong.png' : liveProds.get(productSnapshot).productMedia.first.dir}"
                                                 class="w-14 h-14 object-cover rounded border border-gray-200"
                                                 alt="Product"/>
                                        </a>
                                        <div class="flex-1 min-w-0">
                                            <a th:href="${liveProds.get(productSnapshot) == null ? '#' : '/product/' + productSnapshot.productId}"
                                               class="text-sm font-semibold text-gray-900 hover:text-blue-600 transition-colors block">
                                                <span th:text="${productSnapshot.title}"></span>
                                                <span class="ml-3 text-gray-700 hover:text-blue-600"
                                                      th:if="${pack.status == 'SUCCESS'}"
                                                >(Feedback)</span>
                                            </a>
                                            <div th:if="${!#lists.isEmpty(productSnapshot.productPropertySnapshots)}"
                                                 class="space-y-1 mt-2">
                                                <p th:each="prop : ${productSnapshot.productPropertySnapshots}"
                                                   class="text-xs text-gray-600">
                                                    <span class="font-medium" th:text="${prop.name}"></span>:
                                                    <span th:text="${prop.data}"></span>
                                                </p>
                                            </div>
                                        </div>
                                    </div>
                                </td>
                                <td class="px-6 py-4 text-center">
                                    <span class="text-sm font-medium text-gray-900"
                                          th:text="${productSnapshot.quantity}"></span>
                                </td>
                                <td class="px-6 py-4 text-center text-sm font-medium text-gray-900">
                                    <span th:if="${liveProds.get(productSnapshot) != null}"
                                          th:text="${liveProds.get(productSnapshot).price} + '₫'"></span>
                                </td>
                                <td class="px-6 py-4 text-right">
                                    <span class="text-sm font-bold text-red-600"
                                          th:text="${productSnapshot.price} + '₫'"></span>
                                </td>
                            </tr>

                            <tr th:if="${#lists.isEmpty(productSnapshots)}">
                                <td colspan="4" class="px-6 py-12 text-center">
                                    <p class="text-gray-500 font-medium">No items in this order</p>
                                </td>
                            </tr>
                            </tbody>
                        </table>
                    </div>
                </div>

                <div class="mt-6 flex gap-3 justify-end">
                    <th:block th:if="${pack.status == 'PENDING_PAYMENT'}">
                        <a th:href="@{'/checkout/pay/' + ${pack.id}}"
                           class="inline-flex justify-center bg-blue-600 px-4 py-2 text-sm font-semibold text-white shadow-xs hover:bg-blue-500 cursor-pointer rounded">
                            <span>Pay now</span>
                        </a>
                    </th:block>
                    <th:block th:if="${pack.status == 'PENDING_PAYMENT' || pack.status == 'PENDING_APPROVAL'}">
                        <form method="post" th:action="@{'/order-history/cancel/' + ${pack.id}}">
                            <button type="submit"
                                    class="remove-item-btn bg-red-600 px-4 py-2 text-white text-sm font-medium shadow-sm hover:bg-red-700 focus:outline-none focus:ring-2 focus:ring-red-500 focus:ring-offset-2 transition-colors">
                                Cancel
                            </button>
                        </form>
                    </th:block>
                    <a th:href="@{/order-history}"
                       class="remove-item-btn bg-gray-600 px-4 py-2 text-white text-sm font-medium shadow-sm hover:bg-gray-700 focus:outline-none focus:ring-2 focus:ring-gray-500 focus:ring-offset-2 transition-colors">
                        Back
                    </a>
                </div>
            </div>
        </main>
    </th:block>
</th:block>
<footer th:replace="~{fragment/user/footer :: footer}"></footer>
</html>