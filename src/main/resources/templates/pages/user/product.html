<html xmlns:th="http://www.thymeleaf.org" lang="en">
<th:block th:replace="~{layout/base :: layout(~{::content}, 'Product details')}">
    <th:block th:fragment="content">
        <header th:replace="~{fragment/user/header :: header}"></header>
        <th:block th:replace="~{fragment/user/navbar :: navbar}"></th:block>
        <div class="max-w-7xl p-6 mt-4 mb-4 mx-auto">
            <div class="flex space-y-4 gap-6">
                <div class="w-1/3">
                    <div class="w-auto">
                        <img th:if="${product.productMedia.size() > 0}"
                             th:src="${product.productMedia.get(0).dir}" alt="Product image"
                             class="rounded-2xl overflow-hidden shadow-lg w-full h-auto"></div>
                </div>
                <div class="w-1/3">
                    <form id="item-form" method="POST" class="space-y-4">
                        <div><h1 class="text-2xl font-bold" th:text="${product.title}"></h1>
                            <p class="text-gray-700 leading-relaxed" th:text="${product.description}"></p>
                            <div class="flex items-baseline gap-2"><p class="font-semibold text-lg">Price:</p>
                                <p id="display-prod-price" class="text-red-600 text-3xl font-bold"
                                   th:text="${product.price} + ' ₫'"></p></div>
                            <input id="root-prod-price" th:value="${product.price}" hidden/></div>
                        <input id="id" name="id" th:value="${product.id}" hidden/>
                        <div th:each="f : ${product.productType.productPropertyFields}"
                             class="flex flex-col space-y-3 mb-6"><h2
                                th:text="${'Choose ' + f.name.toLowerCase() + ':'}" class="font-semibold text-lg"></h2>
                            <div class="flex flex-wrap gap-1">
                                <div th:each="foption : ${product.productPropertyData}"
                                     th:if="${foption.productPropertyField.name == f.name}" class="w-auto">
                                    <input
                                        type="checkbox" th:name="${'property-data-' + f.id}"
                                        th:id="${'property-data-id-' + foption.id}" th:value="${foption.id}"
                                        class="real-option-data hidden peer"/>
                                    <label th:if="${stockGroupStatus.get(foption.id)}" th:for="${'property-data-id-' + foption.id}"
                                         th:alt="${f.id}" th:text="${foption.data}"
                                         th:data="${foption.price}"
                                         class="select-option block px-4 py-2 border-2 border-gray-300 cursor-pointer text-black hover:border-black transition text-center peer-checked:border-black peer-checked:bg-black peer-checked:text-white"
                                         th:classappend="${'label-property-data-id-' + foption.id}"
                                           style="min-width: 60px;"> </label>
                                </div>
                            </div>
                        </div>
                        <div class="flex space-x-2 items-center">
                            <div class="flex items-center space-x-3"><h2 class="font-semibold">Quantity:</h2>
                                <div class="inline-flex items-center border border-gray-300 overflow-hidden">
                                    <button type="button" id="decrease-btn"
                                            class="w-10 h-10 flex items-center justify-center hover:bg-gray-100 text-gray-600 transition-colors border-r border-gray-300">
                                        <span class="text-lg">−</span></button>
                                    <input id="amount-input" name="amount" type="number" value="1" min="1" max="100"
                                           class="font-medium text-gray-800 w-16 text-center outline-none"/>
                                    <button type="button" id="increase-btn"
                                            class="w-10 h-10 flex items-center justify-center hover:bg-gray-100 text-gray-600 transition-colors border-l border-gray-300">
                                        <span class="text-lg">+</span></button>
                                </div>
                            </div>
                        </div>
                        <button type="submit"
                                class="add-item-btn text-center inline-flex w-full justify-center bg-red-600 px-5 py-2 font-semibold text-white shadow-xs hover:bg-red-500 sm:w-auto cursor-pointer">
                            Add to cart
                        </button>
                    </form>
                </div>
                <div class="w-1/3"><h2 class="text-2xl font-bold mb-4 border-b-2 border-red-500 pb-2 inline-block">
                    Related products </h2>
                    <div th:if="${#lists.isEmpty(sameTypeProducts)}" class="text-center text-gray-600 font-medium mt-4">
                        No related products available.
                    </div>
                    <div th:unless="${#lists.isEmpty(sameTypeProducts)}" class="grid grid-cols-2 gap-4 mt-4"><a
                            th:each="p : ${sameTypeProducts.subList(0, sameTypeProducts.size() < 4 ? sameTypeProducts.size() : 4)}"
                            th:href="@{'/product/' + ${p.id}}" th:data-ptitle="${p.title}"
                            class="rounded-2xl overflow-hidden shadow-lg hover:shadow-2xl transition-all relative h-40 w-full hover:scale-105">
                        <img th:src="${p.productMedia.get(0).dir}" alt="Product image" class="w-full h-40 object-cover">
                        <div class="absolute inset-0 bg-gradient-to-t from-black/60 via-black/30 to-transparent"></div>
                        <div class="absolute inset-0 p-3 flex flex-col justify-end"><p
                                class="text-white font-medium mb-1 text-xs" th:text="${p.title}"></p>
                            <p class="text-lg font-bold text-yellow-300" th:text="${p.price + ' ₫'}"></p></div>
                    </a></div>
                </div>
            </div>
            <div class="product-collateral mt-3">
                <div class="max-w-7xl">
                    <ul id="product-detail-tab" class="flex flex-wrap gap-1 space-y-2 mb-8">
                        <li><a href="#tab1"
                               class="text-center inline-flex w-full justify-center bg-black px-5 py-2 font-semibold text-white shadow-xs hover:bg-red-500 sm:w-auto cursor-pointer">Purchase
                            guide</a></li>
                        <li><a href="#tab2"
                               class="text-center inline-flex w-full justify-center bg-black px-5 py-2 font-semibold text-white shadow-xs hover:bg-red-500 sm:w-auto cursor-pointer">How
                            to choose size</a></li>
                        <li><a href="#tab3"
                               class="text-center inline-flex w-full justify-center bg-black px-5 py-2 font-semibold text-white shadow-xs hover:bg-red-500 sm:w-auto cursor-pointer">Customer
                            reviews</a></li>
                    </ul>
                    <div id="productTabContent" class="space-y-8">
                        <div class="bg-white border-gray-500" id="tab1"><h2
                                class="text-2xl-removed-removed font-bold mb-6 border-b-2 border-red-500 pb-2 inline-block">
                            Purchase guide</h2>
                            <div class="space-y-4 mt-6"><p class="font-bold mb-2">Step 1: Visit our website and choose
                                the product you want to buy</p>
                                <p>You can use the size filter to quickly find the model that fits you best.</p>
                                <p class="font-bold mb-2">Step 2: Click on the product you want to buy</p>
                                <p>Click the <span class="text-red-600 font-bold">BUY NOW</span> red button and don't
                                    forget to select your size.</p>
                                <p class="font-bold mb-2">Step 3: Fill in your order information</p>
                                <p>Your phone number and detailed address are very important, so please double-check
                                    after filling them in.</p>
                                <p class="font-bold mb-2">Step 4: Review and submit your order</p>
                                <p>After receiving your order, SPORTS-STORE will usually call you immediately, so please
                                    keep an eye on your phone.</p></div>
                        </div>
                        <div class="bg-white border-gray-500" id="tab2"><h2
                                class="text-2xl font-bold mb-6 border-b-2 border-red-500 pb-2 inline-block"> How to
                            choose size</h2>
                            <div class="grid grid-cols-2 gap-8 mt-6">
                                <div class="space-y-6">
                                    <div><h3 class="font-bold mb-2">Method 1: Based on your current shoes (95%
                                        accuracy)</h3>
                                        <p class="mb-2">Take out your current pair of shoes and check the size (if you
                                            rarely play football, you can borrow from a teammate or neighbor :D)</p>
                                        <p class="mb-2">If you're wearing fabric shoes (Thuong Dinh, Thashoco, Bata
                                            Warrior, etc.), you should go up 1 size when choosing.</p>
                                        <p class="mb-2 font-semibold">(Example: If you wear Thuong Dinh size 39, choose
                                            size 40)</p>
                                        <p>If you're wearing Nike, Adidas, Puma, etc., keep your current size.</p></div>
                                    <div><h3 class="font-bold mb-2">Method 2: Based on the size chart (80%
                                        accuracy)</h3>
                                        <p class="mb-4">If you don't have a pair of shoes nearby, you can measure your
                                            foot and compare it with the chart below.</p></div>
                                </div>
                                <div class="space-y-6"><h4 class="text-center font-bold mb-4">Size Chart</h4>
                                    <div class="flex justify-center space-y-4">
                                        <div class=""><img src="/assets/img/size.png" alt="shoe size"
                                                           class="w-100 h-60 "></div>
                                        <div class=""><img src="/assets/img/size_guide.png" alt="clothing size"
                                                           class="w-100 h-80"></div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="bg-white" id="tab3">
                            <div class="mb-12"><h2
                                    class="text-3xl font-bold mb-8 border-b-4 border-red-500 pb-3 inline-block text-gray-900">
                                Customer Reviews </h2>
                                <div class="w-full flex gap-8 mt-8 auto-rows-max">
                                    <div class="w-2/5">
                                        <div class="bg-gray-50 p-8 shadow-lg h-full">
                                            <div class="w-full flex flex-col items-center text-center"><h3
                                                    class="text-lg font-bold text-gray-900">Overall Rating</h3>
                                                <div class="text-6xl font-bold text-red-600 mb-3"
                                                     th:text="${#numbers.formatDecimal(averageRating, 1, 1)}"></div>
                                                <div class="flex gap-1 justify-center" th:if="${totalFeedbacks > 0}">
                                                    <span th:each="i : ${#numbers.sequence(1, fullStars)}"
                                                          th:if="${fullStars > 0}"
                                                          class="text-3xl">★</span>
                                                    <span th:if="${hasHalfStar}"
                                                          class="text-3xl">⯨</span>
                                                    <span th:each="i : ${#numbers.sequence(1, emptyStars)}"
                                                          th:if="${emptyStars > 0}"
                                                          class="text-3xl text-gray-300">★</span>
                                                </div>
                                                <div class="text-lg mb-2 text-red-400"
                                                     th:text="${totalFeedbacks} + ' reviews'"></div>
                                            </div>
                                            <div class="space-y-4">
                                                <div class="flex items-center space-x-3 group"><span
                                                        class="text-sm font-bold text-gray-700 w-16">5★</span>
                                                    <div class="flex-1 bg-gray-200 rounded-full h-4 overflow-hidden shadow-sm">
                                                        <div class="bg-gradient-to-r from-yellow-400 to-yellow-500 h-full rounded-full transition-all duration-300 group-hover:shadow-lg"
                                                             th:style="'width: ' + ${totalFeedbacks > 0 ? (count5 * 100.0 / totalFeedbacks) : 0} + '%'"></div>
                                                    </div>
                                                    <span class="text-sm font-bold text-red-600 w-12 text-right"
                                                          th:text="${count5}"></span></div>
                                                <div class="flex items-center space-x-3 group"><span
                                                        class="text-sm font-bold text-gray-700 w-16">4★</span>
                                                    <div class="flex-1 bg-gray-200 rounded-full h-4 overflow-hidden shadow-sm">
                                                        <div class="bg-gradient-to-r from-yellow-400 to-yellow-500 h-full rounded-full transition-all duration-300 group-hover:shadow-lg"
                                                             th:style="'width: ' + ${totalFeedbacks > 0 ? (count4 * 100.0 / totalFeedbacks) : 0} + '%'"></div>
                                                    </div>
                                                    <span class="text-sm font-bold text-red-600 w-12 text-right"
                                                          th:text="${count4}"></span></div>
                                                <div class="flex items-center space-x-3 group"><span
                                                        class="text-sm font-bold text-gray-700 w-16">3★</span>
                                                    <div class="flex-1 bg-gray-200 rounded-full h-4 overflow-hidden shadow-sm">
                                                        <div class="bg-gradient-to-r from-yellow-400 to-yellow-500 h-full rounded-full transition-all duration-300 group-hover:shadow-lg"
                                                             th:style="'width: ' + ${totalFeedbacks > 0 ? (count3 * 100.0 / totalFeedbacks) : 0} + '%'"></div>
                                                    </div>
                                                    <span class="text-sm font-bold text-red-600 w-12 text-right"
                                                          th:text="${count3}"></span></div>
                                                <div class="flex items-center space-x-3 group"><span
                                                        class="text-sm font-bold text-gray-700 w-16">2★</span>
                                                    <div class="flex-1 bg-gray-200 rounded-full h-4 overflow-hidden shadow-sm">
                                                        <div class="bg-gradient-to-r from-yellow-400 to-yellow-500 h-full rounded-full transition-all duration-300 group-hover:shadow-lg"
                                                             th:style="'width: ' + ${totalFeedbacks > 0 ? (count2 * 100.0 / totalFeedbacks) : 0} + '%'"></div>
                                                    </div>
                                                    <span class="text-sm font-bold text-red-600 w-12 text-right"
                                                          th:text="${count2}"></span></div>
                                                <div class="flex items-center space-x-3 group"><span
                                                        class="text-sm font-bold text-gray-700 w-16">1★</span>
                                                    <div class="flex-1 bg-gray-200 rounded-full h-4 overflow-hidden shadow-sm">
                                                        <div class="bg-gradient-to-r from-yellow-400 to-yellow-500 h-full rounded-full transition-all duration-300 group-hover:shadow-lg"
                                                             th:style="'width: ' + ${totalFeedbacks > 0 ? (count1 * 100.0 / totalFeedbacks) : 0} + '%'"></div>
                                                    </div>
                                                    <span class="text-sm font-bold text-red-600 w-12 text-right"
                                                          th:text="${count1}"></span></div>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="w-3/5">
                                        <div class="bg-gray-50 p-8 shadow-lg h-full">
                                            <div class="mb-6"><h3 class="text-2xl font-bold text-gray-900 mb-2">Share
                                                Your Experience</h3>
                                                <p class="text-gray-600">Your feedback helps other customers make better
                                                    decisions</p></div>
                                            <form method="POST" id="feedback-form" class="space-y-6"><input
                                                    id="fb-product-id" name="id" th:value="${product.id}" hidden/>
                                                <div><label
                                                        class="block font-bold text-gray-800 mb-3 text-sm uppercase tracking-wide">Rating</label>
                                                    <div class="relative">
                                                        <select id="fb-rating" name="rating"
                                                                class="w-full px-4 py-2.5 border bg-white rounded-lg focus:outline-none focus:ring-2 focus:ring-gray-300 text-sm">
                                                            <option value="5" class="text-gray-900">★★★★★ <span
                                                                    class="text-gray-700">Excellent - Highly recommend!</span>
                                                            </option>
                                                            <option value="4" class="text-gray-900">★★★★ <span
                                                                    class="text-gray-700">Very Good - Great product</span>
                                                            </option>
                                                            <option value="3" class="text-gray-900">★★★ <span
                                                                    class="text-gray-700">Good - It's okay</span></option>
                                                            <option value="2" class="text-gray-900">★★ <span
                                                                    class="text-gray-700">Fair - Has issues</span></option>
                                                            <option value="1" class="text-gray-900">★ <span
                                                                    class="text-gray-700">Poor - Not satisfied</span>
                                                            </option>
                                                        </select></div>
                                                </div>
                                                <div><label
                                                        class="block font-bold text-gray-800 mb-3 text-sm uppercase tracking-wide">
                                                    Review Content <span class="text-red-600 ml-1">*</span> </label>
                                                    <textarea id="fb-content" name="content" required rows="5"
                                                              placeholder="Share your honest thoughts about this product... Tell us what you liked or didn't like!"
                                                              class="w-full px-4 py-2.5 border border-2 bg-white rounded-lg focus:outline-none focus:ring-2 focus:ring-gray-300 text-sm border border-gray-300"></textarea>
                                                    <p class="text-gray-500 text-xs mt-2">Min 10 characters • Be
                                                        specific and helpful</p></div>
                                                <button type="submit"
                                                        class="inline-flex w-full justify-center bg-red-600 px-3 py-2 text-sm font-semibold text-white shadow-xs hover:bg-red-500 cursor-pointer">
                                                    Submit Your Review
                                                </button>
                                            </form>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div th:each="fb : ${feedbacks}"
                             class="border-b border-gray-200 py-6 hover:bg-gray-50 transition duration-200 px-4 rounded-lg">
                            <div class="flex items-start gap-4"><img
                                    src="https://cdn-icons-png.flaticon.com/512/4322/4322991.png" alt="User"
                                    class="w-12 h-12 rounded-full border-2 border-gray-300 shadow-sm flex-shrink-0"/>
                                <div class="flex-1 min-w-0">
                                    <div class="flex items-center justify-between gap-2 mb-2">
                                        <div class="flex items-center gap-2"><p class="text-sm font-bold text-gray-900"
                                                                                th:text="${fb.user.username}">
                                            Username</p>
                                            <div class="flex items-center gap-1"><span
                                                    th:each="i : ${#numbers.sequence(1,5)}"> <svg
                                                    xmlns="http://www.w3.org/2000/svg"
                                                    th:classappend="${i <= fb.rating} ? 'text-yellow-400' : 'text-gray-300'"
                                                    viewBox="0 0 24 24" fill="currentColor" class="w-4 h-4"> <path
                                                    fill-rule="evenodd"
                                                    d="M12 17.27l5.18 3.04-1.64-5.81L20 9.24l-6.09-.52L12 3.5 10.09 8.72 4 9.24l4.46 5.26-1.64 5.81L12 17.27z"
                                                    clip-rule="evenodd"/> </svg> </span></div>
                                        </div>
                                        <div class="flex items-center gap-2"><p
                                                class="text-xs text-gray-400 whitespace-nowrap"
                                                th:text="${#dates.format(fb.createdAt, 'dd/MM/yyyy HH:mm')}">
                                            12/11/2025</p>
                                            <button type="button"
                                                    class="delete-feedback-btn text-xs text-red-600 hover:underline"
                                                    th:data-id="${fb.id}"> Delete
                                            </button>

                                            <button type="button"
                                                    class="update-feedback-btn text-xs text-blue-600 hover:underline"
                                                    th:data-id="${fb.id}">
                                                Update
                                            </button>
                                        </div>
                                    </div>
                                    <p class="text-sm text-gray-800 leading-relaxed mb-4 font-medium"
                                       th:text="${fb.comment}">Comment here...</p>
                                    <div th:if="${fb.reply != null and fb.reply != ''}"
                                         class="bg-gray-100 rounded-lg p-3 mb-2"><p
                                            class="text-xs font-semibold text-gray-600 mb-1">Reply:</p>
                                        <p class="text-sm text-gray-700" th:text="${fb.reply}">Reply content...</p>
                                    </div>
                                    <input type="hidden" id="content-${fb.id}" th:value="${fb.comment}"/>
                                    <input type="hidden" id="rating-${fb.id}" th:value="${fb.rating}"/>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <footer th:replace="~{fragment/user/footer :: footer}"></footer>
        <script src="/assets/js/pages/user/home.js"></script>
        <script src="/assets/js/pages/user/product.js"></script>
        <script src="/assets/js/pages/user/feedback.js"></script>
    </th:block>
</th:block>
</html>