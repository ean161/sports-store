<html xmlns:th="http://www.thymeleaf.org" lang="en">
<th:block th:replace="~{layout/base :: layout(~{::content}, 'Product details')}">
    <th:block th:fragment="content">
        <header th:replace="~{fragment/user/header :: header}"></header>
        <th:block th:replace="~{fragment/user/navbar :: navbar}"></th:block>

        <div class="max-w-7xl p-6 mt-4 mb-4 mx-auto">
            <div class="flex justify-between space-y-4">
                <div class="flex space-y-4">
                    <div class="w-auto  mr-10 ">
                        <img th:if="${product.productMedia.size() > 0}"
                             th:src="${product.productMedia.get(0).dir}"
                             alt="Product image"
                             class="rounded-2xl overflow-hidden shadow-lg w-100 h-100">
                    </div>
                    <form id="item-form" method="POST" class="space-y-4 ">
                        <div>
                            <h1 class="text-2xl-removed-removed font-bold" th:text="${product.title}"></h1>
                            <p class="text-gray-700 leading-relaxed" th:text="${product.description}"></p>
                            <p id="display-prod-price" class="text-red-600 text-3xl font-bold" th:text="${product.price} + '₫'"></p>
                            <input id="root-prod-price" th:value="${product.price}" hidden />
                        </div>

                        <input id="id" name="id" th:value="${product.id}" hidden/>
                        <div th:each="f : ${product.productType.productPropertyFields}"
                             class="flex flex-col space-y-2 mb-4">
                            <h2 th:text="${'Choose ' + f.name.toLowerCase() + ':'}" class="font-semibold"></h2>

                            <div class="flex flex-wrap gap-2">
                                <div th:each="foption : ${product.productPropertyData}"
                                     th:if="${foption.productPropertyField.name == f.name}">

                                    <input type="radio"
                                           th:name="${'property-data-' + f.id}"
                                           th:id="${'property-data-id-' + foption.id}"
                                           th:value="${foption.id}"
                                           class="hidden peer"/>

                                    <label th:for="${'property-data-id-' + foption.id}"
                                           th:alt="${f.id}"
                                           th:text="${foption.data}"
                                           th:data="${foption.price}"
                                           class="select-option px-4 py-2 border-2 border-gray-300 cursor-pointer
                                          text-black hover:border-black transition
                                          peer-checked:border-black peer-checked:bg-black peer-checked:text-white">
                                    </label>

                                </div>
                            </div>
                        </div>

                        <div class="flex space-x-2 items-center">
                            <div class="flex items-center space-x-3">
                                <h2 class="font-semibold">Quantity:</h2>
                                <div class="inline-flex items-center border border-gray-300 overflow-hidden">
                                    <button type="button" id="decrease-btn"
                                            class="w-10 h-10 flex items-center justify-center hover:bg-gray-100 text-gray-600 transition-colors border-r border-gray-300">
                                        <span class="text-lg">−</span>
                                    </button>

                                    <input id="amount-input" name="amount" type="number" value="1" min="1" max="100"
                                           class="font-medium text-gray-800 w-16 text-center outline-none" />

                                    <button type="button" id="increase-btn"
                                            class="w-10 h-10 flex items-center justify-center hover:bg-gray-100 text-gray-600 transition-colors border-l border-gray-300">
                                        <span class="text-lg">+</span>
                                    </button>
                                </div>
                            </div>
                        </div>

                        <button type="submit"
                                class="add-item-btn text-center inline-flex w-full justify-center bg-red-600 px-5 py-2 font-semibold text-white shadow-xs hover:bg-red-500 sm:w-auto cursor-pointer">
                            Add to cart
                        </button>
                    </form>
                </div>

                <div>
                    <h2 class="text-2xl font-bold mb-4 border-b-2 border-red-500 pb-2 inline-block">
                        Related products
                    </h2>

                    <div th:if="${#lists.isEmpty(sameTypeProducts)}" class="text-center text-gray-600 font-medium mt-4">
                        No related products available.
                    </div>

                    <div th:unless="${#lists.isEmpty(sameTypeProducts)}"
                         class="grid grid-cols-2 md:grid-cols-3 lg:grid-cols-2 gap-6 mt-4">
                        <a th:each="p : ${sameTypeProducts.subList(0, sameTypeProducts.size() < 4 ? sameTypeProducts.size() : 4)}"
                           th:href="@{'/product/' + ${p.id}}"
                           th:data-ptitle="${p.title}"
                           class="rounded-2xl overflow-hidden shadow-lg hover:shadow-2xl transition-all relative h-50 w-50 hover:scale-102">
                            <img th:src="${p.productMedia.get(0).dir}" alt="Product image"
                                 class="w-50 h-50 object-cover">
                            <div class="absolute inset-0 bg-gradient-to-t from-black/60 via-black/30 to-transparent"></div>
                            <div class="absolute inset-0 p-5 flex flex-col justify-end">
                                <p class="text-white font-medium mb-1 text-xs" th:text="${p.title}"></p>
                                <p class="text-xl font-bold text-yellow-300" th:text="${p.price + ' ₫'}"></p>
                            </div>
                        </a>
                    </div>
                </div>
            </div>

            <div class="product-collateral mt-3">
                <div class="max-w-7xl">
                    <ul id="product-detail-tab" class="flex flex-wrap gap-1 space-y-2 mb-8">
                        <li>
                            <a href="#tab1"
                               class="text-center inline-flex w-full justify-center bg-black px-5 py-2 font-semibold text-white shadow-xs hover:bg-red-500 sm:w-auto cursor-pointer">Purchase
                                guide</a>
                        </li>
                        <li>
                            <a href="#tab2"
                               class="text-center inline-flex w-full justify-center bg-black px-5 py-2 font-semibold text-white shadow-xs hover:bg-red-500 sm:w-auto cursor-pointer">How
                                to choose size</a>
                        </li>
                        <li>
                            <a href="#tab3"
                               class="text-center inline-flex w-full justify-center bg-black px-5 py-2 font-semibold text-white shadow-xs hover:bg-red-500 sm:w-auto cursor-pointer">Customer
                                reviews</a>
                        </li>
                    </ul>
                    <div id="productTabContent" class="space-y-8">
                        <div class="bg-white border-gray-500" id="tab1">
                            <h2 class="text-2xl-removed-removed font-bold mb-6 border-b-2 border-red-500 pb-2 inline-block">
                                Purchase guide</h2>
                            <div class="space-y-4 mt-6">

                                <p class="font-bold mb-2">Step 1: Visit our website and choose the product you want to
                                    buy</p>
                                <p>You can use the size filter to quickly find the model that fits you best.</p>

                                <p class="font-bold mb-2">Step 2: Click on the product you want to buy</p>
                                <p>Click the <span class="text-red-600 font-bold">BUY NOW</span> red button and don't
                                    forget to select your size.</p>

                                <p class="font-bold mb-2">Step 3: Fill in your order information</p>
                                <p>Your phone number and detailed address are very important, so please double-check
                                    after filling them in.</p>

                                <p class="font-bold mb-2">Step 4: Review and submit your order</p>
                                <p>After receiving your order, SPORTS-STORE will usually call you immediately, so please
                                    keep an eye on your phone.</p>
                            </div>
                        </div>

                        <div class="bg-white border-gray-500" id="tab2">
                            <h2 class="text-2xl font-bold mb-6 border-b-2 border-red-500 pb-2 inline-block">
                                How to choose size</h2>
                            <div class="grid grid-cols-2 gap-8 mt-6">
                                <div class="space-y-6">
                                    <div>
                                        <h3 class="font-bold mb-2">Method 1: Based on your current shoes (95%
                                            accuracy)</h3>
                                        <p class="mb-2">Take out your current pair of shoes and check the size (if you
                                            rarely play football, you can borrow from a teammate or neighbor :D)</p>
                                        <p class="mb-2">If you're wearing fabric shoes (Thuong Dinh, Thashoco, Bata
                                            Warrior,
                                            etc.), you should go up 1 size when choosing.</p>
                                        <p class="mb-2 font-semibold">(Example: If you wear Thuong Dinh size 39, choose
                                            size
                                            40)</p>
                                        <p>If you're wearing Nike, Adidas, Puma, etc., keep your current size.</p>
                                    </div>

                                    <div>
                                        <h3 class="font-bold mb-2">Method 2: Based on the size chart (80%
                                            accuracy)</h3>
                                        <p class="mb-4">If you don't have a pair of shoes nearby, you can measure your
                                            foot and
                                            compare it with the chart below.</p>
                                    </div>
                                </div>

                                <div class="space-y-6">
                                    <h4 class="text-center font-bold mb-4">Size Chart</h4>
                                    <div class="flex justify-center space-y-4">
                                        <div class="">
                                            <img src="/assets/img/size.png" alt="shoe size" class="w-100 h-60 ">
                                        </div>
                                        <div class="">
                                            <img src="/assets/img/size_guide.png" alt="clothing size"
                                                 class="w-100 h-80">
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- Customer Reviews Tab -->
                        <div class="bg-white border-gray-500" id="tab3">
                            <h2 class="text-2xl font-bold mb-6 border-b-2 border-red-500 pb-2 inline-block">
                                Customer reviews</h2>

                            <div class="grid grid-cols-1 lg:grid-cols-2 gap-6 mt-6">
                                <!-- Review Statistics -->
                                <div class="lg:col-span-1">
                                    <div class="bg-gray-50 p-6 top-6 w-full">
                                        <h3 class="text-xl font-bold mb-4">Overall Rating</h3>

                                        <div class="text-center mb-6 pb-6 border-b border-gray-200">
                                            <div class="text-5xl font-bold text-red-600 mb-2">4.5</div>
                                            <div class="flex justify-center text-yellow-400 text-2xl mb-2">
                                                <span>★★★★</span><span class="text-gray-300">★</span>
                                            </div>
                                            <p class="text-gray-600">Based on 156 reviews</p>
                                        </div>

                                        <div class="space-y-3">
                                            <div class="flex items-center space-x-3">
                                                <span class="text-sm font-semibold w-12">5 star</span>
                                                <div class="flex-1 bg-gray-200 rounded-full h-3 overflow-hidden">
                                                    <div class="bg-yellow-400 h-full rounded-full" style="width: 57%"></div>
                                                </div>
                                                <span class="text-sm text-gray-600 w-8">89</span>
                                            </div>
                                            <div class="flex items-center space-x-3">
                                                <span class="text-sm font-semibold w-12">4 star</span>
                                                <div class="flex-1 bg-gray-200 rounded-full h-3 overflow-hidden">
                                                    <div class="bg-yellow-400 h-full rounded-full" style="width: 29%"></div>
                                                </div>
                                                <span class="text-sm text-gray-600 w-8">45</span>
                                            </div>
                                            <div class="flex items-center space-x-3">
                                                <span class="text-sm font-semibold w-12">3 star</span>
                                                <div class="flex-1 bg-gray-200 rounded-full h-3 overflow-hidden">
                                                    <div class="bg-yellow-400 h-full rounded-full" style="width: 12%"></div>
                                                </div>
                                                <span class="text-sm text-gray-600 w-8">18</span>
                                            </div>
                                            <div class="flex items-center space-x-3">
                                                <span class="text-sm font-semibold w-12">2 star</span>
                                                <div class="flex-1 bg-gray-200 rounded-full h-3 overflow-hidden">
                                                    <div class="bg-yellow-400 h-full rounded-full" style="width: 2%"></div>
                                                </div>
                                                <span class="text-sm text-gray-600 w-8">3</span>
                                            </div>
                                            <div class="flex items-center space-x-3">
                                                <span class="text-sm font-semibold w-12">1 star</span>
                                                <div class="flex-1 bg-gray-200 rounded-full h-3 overflow-hidden">
                                                    <div class="bg-yellow-400 h-full rounded-full" style="width: 1%"></div>
                                                </div>
                                                <span class="text-sm text-gray-600 w-8">1</span>
                                            </div>
                                        </div>
                                    </div>
                                </div>

                                <div id="review-form-section" class="bg-gray-50 p-6">
                                    <h3 class="text-xl font-bold mb-6">Write your review</h3>
                                    <form id="review-form" method="POST" th:action="@{'/product/' + ${product.id} + '/review'}" class="space-y-4">
                                        <div>
                                            <label class="block font-semibold mb-2">Your rating: <span class="text-red-600">*</span></label>
                                            <div id="star-rating" class="flex space-x-1 text-3xl cursor-pointer">
                                                <span class="star-icon text-gray-300 hover:text-yellow-400 transition" data-rating="1">★</span>
                                                <span class="star-icon text-gray-300 hover:text-yellow-400 transition" data-rating="2">★</span>
                                                <span class="star-icon text-gray-300 hover:text-yellow-400 transition" data-rating="3">★</span>
                                                <span class="star-icon text-gray-300 hover:text-yellow-400 transition" data-rating="4">★</span>
                                                <span class="star-icon text-gray-300 hover:text-yellow-400 transition" data-rating="5">★</span>
                                            </div>
                                            <input type="hidden" id="rating-value" name="rating" required>
                                        </div>

                                        <div>
                                            <label class="block font-semibold mb-2">Review content: <span class="text-red-600">*</span></label>
                                            <textarea name="content" required rows="4"
                                                      class="w-full px-4 py-2 border-2 border-gray-300 focus:border-red-500 focus:outline-none transition resize-none"></textarea>
                                        </div>

                                        <button type="submit"
                                                class="w-full bg-red-600 text-white font-semibold py-3 mt-3 hover:bg-red-500 transition shadow-lg">
                                            Submit review
                                        </button>
                                    </form>
                                </div>

                                <div class="lg:col-span-2">
                                    <div class="space-y-6">
                                        <div class="border-b border-t border-gray-200 p-6">
                                            <div class="flex items-start justify-between mb-3">
                                                <div class="flex items-center space-x-3">
                                                    <div>
                                                        <p class="font-bold">Nguyen Van A</p>
                                                        <p class="text-sm text-gray-500">October 15, 2024</p>
                                                    </div>
                                                </div>
                                                <div class="flex text-yellow-400 text-lg">
                                                    ★★★★★
                                                </div>
                                            </div>
                                            <h4 class="font-bold mb-2">Great product, worth the money!</h4>
                                            <p class="text-gray-700 mb-3">I bought these shoes for basketball and I must say I'm very satisfied. Good leather quality, soft sole, fits well. True to European size. Fast delivery, careful packaging. Will definitely come back for more!</p>
                                            <div class="flex gap-2 mb-3">
                                                <img th:if="${product.productMedia.size() > 0}"
                                                     th:src="${product.productMedia.get(0).dir}"
                                                     alt="Review image"
                                                     class="w-20 h-20 object-cover rounded-lg cursor-pointer hover:opacity-80 transition">
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <footer th:replace="~{fragment/user/footer :: footer}"></footer>
        <script src="/assets/js/pages/user/product.js"></script>
    </th:block>
</th:block>
</html>